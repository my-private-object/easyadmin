<div class="layuimini-container">
    <form id="app-form" class="layui-form layuimini-form">

        <div class="layui-form-item">
            <label class="layui-form-label">古籍标题</label>
            <div class="layui-input-block">
                <input type="text" name="title" class="layui-input" lay-verify="required" placeholder="请输入商品标题" value="{$row.title|default=''}">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">古籍分类</label>
            <div class="layui-input-block">
                <select name="cate_id" lay-verify="required" data-select="{:url('guji.catehigh/getCateIndexEdit')}" data-fields="id,title" data-value="{$row.cate_id|default=''}">
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">学科分类</label>
            <div class="layui-input-block">
                <select name="cate_bid" lay-verify="required" data-select="{:url('guji.catehigh/getCateEdit')}" data-fields="id,title" data-value="{$row.cate_bid|default=''}" >
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">学科二级分类</label>
            <div class="layui-input-block">
                <select name="cate_wbid" lay-verify="required" data-select="{:url('guji.catehigh/getTwoCateNoJson')}" data-fields="id,title,pid" data-value="{$row.cate_wbid|default=''}">
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">古籍LOGO</label>
            <div class="layui-input-block layuimini-upload">
                <input name="logo" class="layui-input layui-col-xs6" lay-verify="required" placeholder="请上传分类图片" value="{$row.logo|default=''}">
                <div class="layuimini-upload-btn">
                    <span><a class="layui-btn" data-upload="logo" data-upload-number="one" data-upload-exts="png|jpg|ico|jpeg" data-upload-icon="image"><i class="fa fa-upload"></i> 上传</a></span>
                    <span><a class="layui-btn layui-btn-normal" id="select_logo" data-upload-select="logo" data-upload-number="one" data-upload-mimetype="image/*"><i class="fa fa-list"></i> 选择</a></span>
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label required">古籍图片</label>
            <div class="layui-input-block layuimini-upload">
                <input name="images" class="layui-input layui-col-xs6" lay-verify="required" placeholder="请上传商品图片" value="{$row.images|default=''}">
                <div class="layuimini-upload-btn">
                    <span><a class="layui-btn" data-upload="images" data-upload-number="more" data-upload-exts="png|jpg|ico|jpeg" data-upload-icon="image"><i class="fa fa-upload"></i> 上传</a></span>
                    <span><a class="layui-btn layui-btn-normal" id="select_images" data-upload-select="images" data-upload-number="more" data-upload-mimetype="image/*"><i class="fa fa-list"></i> 选择</a></span>
                </div>
            </div>
        </div>

     <!--    <div class="layui-form-item">
            <label class="layui-form-label">市场价格</label>
            <div class="layui-input-block">
                <input type="text" name="market_price" class="layui-input" lay-verify="required" placeholder="请输入市场价格" value="{$row.market_price|default=''}">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">折扣价格</label>
            <div class="layui-input-block">
                <input type="text" name="discount_price" class="layui-input" lay-verify="required" placeholder="请输入折扣价格" value="{$row.discount_price|default=''}">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">虚拟销量</label>
            <div class="layui-input-block">
                <input type="text" name="virtual_sales" class="layui-input" lay-verify="required" placeholder="请输入虚拟销量" value="{$row.virtual_sales|default=''}">
            </div>
        </div> -->

        <div class="layui-form-item">
            <label class="layui-form-label">商品描述</label>
            <div class="layui-input-block">
                <textarea name="describe" rows="20" class="layui-textarea editor" placeholder="请输入商品描述">{$row.describe|raw|default=''}</textarea>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">分类排序</label>
            <div class="layui-input-block">
                <input type="number" name="sort" class="layui-input" placeholder="请输入分类排序" value="{$row.sort|default=''}">
            </div>
        </div>

        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注信息</label>
            <div class="layui-input-block">
                <textarea name="remark" class="layui-textarea" placeholder="请输入备注信息">{$row.remark|default=''}</textarea>
            </div>
        </div>

        <div class="hr-line"></div>
        <div class="layui-form-item text-center">
            <button type="submit" class="layui-btn layui-btn-normal layui-btn-sm" lay-submit>确认</button>
            <button type="reset" class="layui-btn layui-btn-primary layui-btn-sm">重置</button>
        </div>

    </form>
</div>

<script>

    function cnmd(obj) {
        console.log(123123123123);
        var a = $(obj).attr("lay-value");
        // var b = $(obj).prev();
        var b = $(obj).parent().parent().prev().attr('name');
        // var c = $(obj).parent().parent().prev().attr('name');
        console.log(b);

        if ( b != 'cate_id' && b != 'cate_bid' &&  b != 'cate_wbid' ) {
            console.log('非分类操作');
            return;
        }

        if ( b == 'cate_wbid' || b == 'cate_bid' ) {
            $(obj).parent().children().attr('class','');
            $(obj).attr('class', 'layui-this');
            $(obj).parent().prev().children().attr('value', $(obj).text())
            $("select[name='cate_wbid']").val( $(obj).attr('lay-value') )
            // console.log(aa);
            // obj.attr('class', 'layui-this');
            // return
        }

        if ( b == 'cate_id' ) {
            getCate(a)
        }

        if ( b == 'cate_bid') {
            console.log('cate_bid_gogogogog');
            getCateTwo(a)
        }
        


    }

    function getCateTwo(a) {

        $.ajax({
        url:'http://localhost:81/guji/guji.catehigh/gettwocate',
        data:{'id':a},
        type:'post',
        dataType:'json',
        // timeout:3000,
        success:function(result){
            console.log(result);
            $("select[name='cate_wbid']").next().children('dl').children('dd').remove()
            // $("select[name='cate_wbid']").next().children('dl').append("<dd lay-value='' class='layui-select-tips'>请选择</dd>")

            // $("select[name='cate_wbid']").next().children('dl').append("<dd lay-value='222' class='layui-this'>哲学 心理学</dd>")

            $("select[name='cate_wbid']").empty();
            // $("select[name='cate_wbid']").append("<option value=''>"+i+"</option>");
            for( var i=0; i<result.length; i++){
                // $("select[name='cate_wbid']").append("<option value='"+result[i]['id']+"'>"+result[i][title]+"</option>"); //为Select追加一个Option(下拉项)
                $("select[name='cate_wbid']").append(
                    '<option value="' + result[i]['id'] +'">' + result[i]['title'] + '</option>'
                );
                $("select[name='cate_wbid']").next().children('dl').append(
                    '<dd onclick="' + 'cnmd(this)"' + ' lay-value="' + result[i]['id'] + '" class="">' + result[i]['title'] + '</dd>'
                );
            }

            $("select[name='cate_wbid']").next().children().children().attr('value', '请选择')
            // $(obj).parent().prev().children().attr('value', '请选择')
            // $(obj).parent().prev().children().attr('value', $(obj).text())

        },
            error:function(){
            console.log('error:206');
        }
        })

    }


    function getCate(a) {

        $.ajax({
        url:'http://localhost:81/guji/guji.catehigh/getCate',
        data:{'id':a},
        type:'post',
        dataType:'json',
        // timeout:3000,
        success:function(result){
            console.log(result);
            $("select[name='cate_bid']").next().children('dl').children('dd').remove()
            // $("select[name='cate_wbid']").next().children('dl').append("<dd lay-value='' class='layui-select-tips'>请选择</dd>")

            // $("select[name='cate_wbid']").next().children('dl').append("<dd lay-value='222' class='layui-this'>哲学 心理学</dd>")

            $("select[name='cate_bid']").empty();
            // $("select[name='cate_wbid']").append("<option value=''>"+i+"</option>");
            for( var i=0; i<result.length; i++){
                // $("select[name='cate_wbid']").append("<option value='"+result[i]['id']+"'>"+result[i][title]+"</option>"); //为Select追加一个Option(下拉项)
                $("select[name='cate_bid']").append(
                    '<option value="' + result[i]['id'] +'">' + result[i]['title'] + '</option>'
                );
                $("select[name='cate_bid']").next().children('dl').append(
                    '<dd onclick="' + 'cnmd(this)"' + ' lay-value="' + result[i]['id'] + '" class="">' + result[i]['title'] + '</dd>'
                );
            }

            // 清空选项卡 2 级分类
            $("select[name='cate_bid']").next().children().children().attr('value', '请选择')
            // 清空选项卡 3 级分类
            $("select[name='cate_wbid']").empty();
            $("select[name='cate_wbid']").next().children().children().attr('value', '请选择')
            $("select[name='cate_wbid']").next().children('dl').children('dd').remove()
            // $(obj).parent().prev().children().attr('value', '请选择')
            // $(obj).parent().prev().children().attr('value', $(obj).text())

        },
            error:function(){
            console.log('error:205');
        }
        })

    }

    // layui.use(['form','jquery'],function(){
        // var form = layui.form;
        // var $ = layui.jquery;

        // $ajax.({
        //     url:'guji.catehigh/gettwocate?id=271',
        //     success:(reponse)=>{
        //         var s1=$('#s1')
        //         s1.html('<option value="">请选择</option>')
        //         for(var i=0;i<reponse.length,i++){
        //             s1.append('<option value=">'+reponse[i].id+'">'+response[i].name +'</option>')
        //         }
        //         form.render('select')
        //     }
        // })
        // form.on("select(cate_bid)",function(data)){
        //     console.log('aaaaaaaaaaaaaaaaaaaaaaaaa');
        //     var id = data.value
        //     $.ajax({
        //         url:'guji.catehigh/gettwocate?id=271?id=' + id,
        //         success:(reponse)=>{
        //             var s2=$("#s2")
        //             s2.html('<option value="">请选择</option>')
        //             for (var i=0;i<response.length; i++){
        //                 s2.append('<option value="'+response[i].id+'">'+response[i].name+'</option>')
        //             }
        //             form.render('select')
        //         }
        //     })
        // }
    // })
    //$(document).click(function(e) { // 在页面任意位置点击而触发此事件
    //    $(e.target).attr("id");       // e.target表示被点击的目标
    //    console.log('aaaaaaaaaaaaaaaaaaaaa');
    //})
    //此方法对于想要获取击元素获得当前点击元素信息如id，value，等信息，无法准确定位，获取，因此需要this，及当前之意


    // function selectOne() {
    //     // console.log(e);
    //     console.log('aaaaaaaaaaaaaaaaaaaaa');
    // }; -->

</script>